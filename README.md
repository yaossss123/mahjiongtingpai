# 麻将听牌判断程序

一个用Python实现的麻将听牌分析工具，支持百搭牌功能，可以输入13张牌并计算出所有可能的胡牌。

## 🎯 最新更新 (v3.0)

- 🖥️ **全新图形界面**：基于tkinter的现代化GUI界面
- 🎨 **可视化牌面**：支持麻将牌图片显示和点击输入
- 🖱️ **交互式操作**：鼠标点击选牌，直观便捷
- 📊 **图形化结果**：听牌结果可视化展示
- 🎯 **资源管理**：智能图片资源加载和缓存
- ✨ **保持所有v2.0功能**：百搭牌、国士无双等

## 🚀 快速开始

### 图形界面版本（推荐）

```bash
# 安装依赖
pip install -r requirements.txt

# 启动图形界面
python mahjong_gui.py
```

### 命令行版本

```bash
# 运行命令行版本
python demo.py

# 运行测试程序
python test_mahjong.py
```

## 📱 界面预览

### 图形界面特性
- **手牌区域**：显示当前选择的13张牌
- **牌选择器**：点击选择万子、筒子、索子、字牌
- **控制按钮**：分析、清空、撤销、示例
- **结果面板**：图形化显示听牌结果
- **状态栏**：实时显示操作状态和手牌数量

### 操作流程
1. 🖱️ **选择手牌**：在牌选择器中点击麻将牌
2. 👀 **查看手牌**：在手牌区域确认选择的牌
3. 🔍 **开始分析**：点击绿色"分析"按钮
4. 📊 **查看结果**：在右侧面板查看听牌分析

## 功能特点

### 核心功能
- ✅ 支持标准麻将规则（4面子+1对子）
- ✅ 支持七对子胡牌
- ✅ **支持国士无双胡牌**
- ✅ **支持百搭牌（万能牌）功能**
- ✅ 支持所有花色：条子、万子、筒子、字牌
- ✅ 智能听牌分析，显示所有可胡的牌
- ✅ 详细的手牌统计信息

### 界面功能
- 🖥️ **现代化GUI界面**：基于tkinter的用户友好界面
- 🎨 **可视化牌面**：支持麻将牌图片显示
- 🖱️ **点击式输入**：鼠标点击选择麻将牌
- 📊 **图形化结果展示**：听牌结果可视化
- ⌨️ **快捷键支持**：F5分析、Ctrl+C清空等
- 💾 **手牌保存/加载**：支持手牌配置的保存和加载
- 🎯 **示例功能**：一键加载测试用例

## 📁 项目结构

### 基本使用

```bash
# 运行主程序
python mahjong_tingpai.py

# 运行测试程序
python test_mahjong.py
```

### 输入格式

输入13张牌，使用上述表示法：

```
# 示例1：万子顺子 + 筒子听牌
123456789m112p34p

# 示例2：七对子听牌
1122334455667m8m

# 示例3：字牌混合
123m456p789s111z2z
```

## 程序结构

### 主要文件

- `mahjong_tingpai.py` - 主程序，包含核心算法和百搭牌功能
- `test_mahjong.py` - 测试程序，包含测试用例和演示
- `README.md` - 说明文档

### 核心类：MahjongTingpaiWithJoker

#### 主要方法

- `parse_hand(hand_str)` - 解析手牌字符串（支持百搭牌）
- `is_winning_hand(tiles)` - 判断14张牌是否胡牌（支持百搭牌）
- `find_winning_tiles(hand)` - 找出所有可胡的牌（考虑百搭牌）
- `analyze_hand(hand_str)` - 完整分析手牌（包含百搭牌分析）
- `print_analysis(result)` - 打印分析结果（显示百搭牌信息）
- `_generate_joker_combinations(tiles)` - 生成百搭牌替换组合
- `_check_thirteen_orphans(tiles)` - 检查国士无双

## 算法说明

### 胡牌判断算法

1. **标准胡牌**：4个面子 + 1个对子
   - 面子：顺子（连续3张同花色）或刻子（3张相同牌）
   - 对子：2张相同牌
   - **百搭牌可以替代任何普通牌**

2. **七对子**：7个不同的对子
   - **百搭牌可以与任何牌组成对子**

3. **国士无双**：13种幺九牌各一张 + 其中一种成对
   - 幺九牌：1m,9m,1p,9p,1s,9s,1z,2z,3z,4z,5z,6z,7z
   - **百搭牌可以替代缺失的幺九牌**

4. **百搭牌替换算法**：
   - 智能生成所有可能的替换组合
   - 性能优化：限制替换数量避免组合爆炸
   - 递归验证每种替换的有效性

### 听牌分析

对每张可能的牌（共34种）：
1. 将其加入手牌形成14张牌
2. 考虑百搭牌的所有可能替换
3. 判断是否构成胡牌
4. 收集所有可胡的牌和对应的胡牌类型


### 示例1：基本听牌

```
输入：123456789m112p34p
结果：听2筒、5筒（两面听）
```

### 示例2：七对子

```
输入：1122334455667m8m
结果：听8万（七对子）
```

### 示例3：字牌听牌

```
输入：123m456p789s111z2z
结果：听南风（2z）
```

## 测试用例

运行 `test_mahjong.py` 可以测试以下情况：

### 基础功能
- ✅ 单钓听牌
- ✅ 边张听牌
- ✅ 坎张听牌
- ✅ 两面听牌
- ✅ 多面听牌
- ✅ 七对子听牌
- ✅ 字牌听牌
- ✅ 混合花色听牌
- ✅ 国士无双听牌
- ✅ 错误输入处理

### 百搭牌功能
- ✅ 百搭牌标准胡牌
- ✅ 百搭牌七对子
- ✅ 百搭牌国士无双
- ✅ 多个百搭牌组合
- ✅ 百搭牌听牌分析
- ✅ 百搭牌替换优化

## 程序特色

### 1. 智能输入解析
- 支持连续数字输入：`123456789s` = `1s2s3s4s5s6s7s8s9s`
- **支持百搭牌输入：`j` 表示万能牌**
- 自动排序和格式化
- 输入验证和错误提示

### 2. 详细分析报告
- 手牌统计信息
- 花色分布
- 牌频统计
- **百搭牌数量和位置**
- 听牌结果（中英文对照）
- **胡牌类型识别**
- **百搭牌替换方案**

### 3. 多种使用模式
- 交互式输入
- 批量测试
- 示例演示
- **百搭牌功能演示**

### 4. 高性能算法
- **智能百搭牌替换**：避免无效组合
- **性能优化**：限制替换数量防止组合爆炸
- **缓存机制**：提高重复计算效率

## 技术实现

### 依赖库
- Python 3.6+
- 标准库：`re`, `collections`, `typing`, `itertools`

### 算法复杂度
- 时间复杂度：O(k^j) - k为可替换牌数，j为百搭牌数量
- 空间复杂度：O(1) - 固定大小的数据结构
- **优化策略**：限制百搭牌数量，智能剪枝

### 代码特点
- 面向对象设计
- 类型提示支持
- 完整的错误处理
- 详细的注释文档
- **模块化百搭牌处理**
- **高效的组合生成算法**

## 支持的胡牌类型

| 胡牌类型 | 说明 | 百搭牌支持 |
|----------|------|------------|
| 标准胡牌 | 4面子+1对子 | ✅ 完全支持 |
| 七对子 | 7个不同对子 | ✅ 完全支持 |
| 国士无双 | 13种幺九牌+1对 | ✅ 完全支持 |

## 扩展功能

### 已实现功能

1. **百搭牌系统**
   - 智能替换算法
   - 性能优化
   - 多百搭牌支持

2. **国士无双**
   - 完整实现
   - 百搭牌兼容
   - 听牌分析

3. **胡牌类型识别**
   - 自动识别胡牌类型
   - 详细分析报告
   - 百搭牌使用说明

### 可能的改进方向

1. **更多胡牌类型**
   - 十三不靠
   - 七星不靠

2. **番数计算**
   - 根据牌型计算番数
   - 支持不同地区规则
   - 百搭牌番数规则

3. **AI建议**
   - 打牌建议
   - 听牌概率分析
   - 百搭牌使用策略

4. **图形界面**
   - GUI界面
   - 牌面可视化
   - 百搭牌标识

## 常见问题

### Q: 为什么我的输入显示"未听牌"？
A: 请检查：
- 是否正好13张牌
- 牌型表示是否正确
- 是否有重复超过4张的牌
- **百搭牌是否用 `j` 表示**

### Q: 百搭牌有什么限制？
A: 百搭牌规则：
- 用 `j` 表示
- 可以替代任何普通牌
- 不能替代另一个百搭牌
- **建议不超过3个百搭牌以保证性能**

### Q: 支持哪些特殊牌型？
A: 目前支持：
- 标准胡牌（4面子+1对子）
- 七对子
- **国士无双**
- **所有类型都支持百搭牌**

### Q: 字牌怎么输入？
A: 字牌用1-7z表示：
- 1z=东, 2z=南, 3z=西, 4z=北
- 5z=白, 6z=发, 7z=中

### Q: 百搭牌如何工作？
A: 百搭牌工作原理：
- 程序自动尝试所有可能的替换
- 选择最优的替换方案
- 显示具体的替换结果
- **智能避免无效组合提高性能**

## 版本历史

### v2.0 (2025年1月) - 百搭牌版本
- ✨ 新增百搭牌功能
- ✨ 新增国士无双支持
- 🚀 性能优化和算法改进
- 📚 完善文档和示例

### v1.0 (2025年1月) - 基础版本
- ✅ 基础听牌功能
- ✅ 标准胡牌和七对子
- ✅ 交互式界面

## 开发信息

- 开发语言：Python 3
- 开发时间：2025年1月
- 版本：2.0（百搭牌版本）
- 许可证：MIT
- 特色功能：**百搭牌系统 + 国士无双**

---

**享受麻将的乐趣！** 🀄 **现在支持百搭牌！** ✨